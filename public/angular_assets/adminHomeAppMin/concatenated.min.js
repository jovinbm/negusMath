angular.module("adminHomeApp",["ui.bootstrap","cfp.loadingBar","angulartics","angulartics.google.analytics","angularMoment","ui.router","duScroll","ngFx","ngAnimate","textAngular","ngSanitize","angularUtils.directives.dirDisqus","ngTagsInput","ui.utils"]).run(["$templateCache","$http","$rootScope","$state","$stateParams",function(e,t,n,o,s){n.$state=o,n.$stateParams=s}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,n){t.when("/home/stream/","/home/stream/1").when("/home/post/","/home").when("/home/editPost/","/home").when("/home/search/","/home/").otherwise("/home"),e.state("home",{url:"/home",templateUrl:"views/admin/partials/views/home.html"}).state("home.stream",{url:"/stream/:pageNumber",templateUrl:"views/admin/partials/views/post_stream.html"}).state("home.post",{url:"/post/:postIndex",templateUrl:"views/admin/partials/views/full_post.html"}).state("home.editPost",{url:"/editPost/:postIndex",templateUrl:"views/admin/partials/views/edit_post.html"}).state("home.search",{url:"/search/:queryString/:pageNumber",templateUrl:"views/search/search_results.html"}).state("users",{url:"/users",templateUrl:"views/admin/partials/views/users.html"}).state("otherwise",{url:"/home"}),n.html5Mode(!1).hashPrefix("!")}]),angular.module("adminHomeApp").controller("HotController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","HotService","fN",function(e,t,n,o,s,r,a,i,u,l,c,d,g,p,m,h){function f(){m.getHotThisWeekFromServer().success(function(e){a.hotThisWeek=m.updateHotThisWeek(e.hotThisWeek)}).error(function(e){a.hotThisWeek=m.updateHotThisWeek([]),i.responseStatusHandler(e)})}a.hotThisWeek=m.getHotThisWeek(),f(),i.$on("reconnect",function(){f()})}]),angular.module("adminHomeApp").controller("MainController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","logoutService","PostService","$document","fN",function(e,t,n,o,s,r,a,i,u,l,c,d,g,p,m,h){function f(){c.getUserData().success(function(e){a.userData=d.userData(e.userData),a.broadcastUserData(),a.clientIsRegistered=a.userData.isRegistered,a.userData.isRegistered&&u.emit("joinRoom",{room:e.userData.uniqueCuid}),a.responseStatusHandler(e)}).error(function(e){a.responseStatusHandler(e)})}a.indexPageUrl=d.allData.indexPageUrl,a.showDisqus=-1!==r.host().search("negusmath");var S=0;a.goToTop=function(){var e=angular.element(document.getElementById("top"));h.scrollToElement(e,80,S)},a.currentTime="",a.currentTime=moment().format("ddd, MMM D, H:mm");var v=function(){a.currentTime=moment().format("ddd, MMM D, H:mm")};o(v,2e4,0,!0),a.broadcastUserData=function(){i.$broadcast("userDataChanges")},a.clientIsRegistered=!1,f();var P=[];i.stateHistory=[],i.$on("$stateChangeSuccess",function(e,t,n,o,s){P.push(r.$$path);var a={};a[o.name]=s,i.stateHistory.push(a)}),i.back=function(){var e=P.length>1?P.splice(-2)[0]:"/";r.path(e)},i.$on("$stateChangeStart",function(e,t,n,o,s){i.clearBanners(),i.clearToasts(),i.isEditingPost=!1}),i.responseStatusHandler=function(e){t("responseFilter")(e)},i.clearBanners=function(){i.$broadcast("clearBanners")},a.showLoadingBanner=function(){i.showHideLoadingBanner&&i.showHideLoadingBanner(!0)},a.hideLoadingBanner=function(){i.showHideLoadingBanner&&i.showHideLoadingBanner(!1)},a.showThePager=function(){i.showThePager&&i.showThePager()},a.hideThePager=function(){i.hideThePager&&i.hideThePager()},a.showSuggested=function(){i.showHideSuggestedPosts&&i.showHideSuggestedPosts(!0)},a.hideSuggested=function(){i.showHideSuggestedPosts&&i.showHideSuggestedPosts(!1)},a.changePagingTotalCount=function(e){i.changePagingTotalCount&&i.changePagingTotalCount(e)},i.$on("reconnect",function(){f()})}]),angular.module("adminHomeApp").controller("FullPostController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","$stateParams","fN",function(e,t,n,o,s,r,a,i,u,l,c,d,g,p,m,h){function f(){a.showLoadingBanner(),p.getPostFromServer(i.$stateParams.postIndex).success(function(e){i.responseStatusHandler(e),0!=h.calcObjectLength(e.thePost)?(a.post=p.updatePost(e.thePost),d.changeDocumentTitle(a.post.postHeading),a.showThePostOnly(),a.showDisqus&&(a.postIsLoaded=!0),a.hideThePager()):(a.post=p.updatePost({}),a.showEditPost=!1,a.showSuggestedPostsOnly(),a.goToTop())}).error(function(e){i.responseStatusHandler(e),a.post=p.updatePost({}),a.showEditPost=!1,a.showSuggestedPostsOnly()})}a.hideThePager(),a.post=p.getCurrentPost(),a.showEditPost=!1,a.showThePostOnly=function(){a.hideLoadingBanner(),a.showEditPost=!0,a.hideSuggested()},a.showSuggestedPostsOnly=function(){a.hideLoadingBanner(),a.showEditPost=!1,a.showSuggested()},a.postIsLoaded=!1,f(),i.$on("postUpdate",function(e,t){i.$stateParams.postIndex==t.post.postIndex&&(a.post=p.updatePost(t.post))}),i.$on("reconnect",function(){i.isEditingPost||"home.post"==i.$state.current.name&&f()})}]).controller("EditPostController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","$stateParams","fN",function(e,t,n,o,s,r,a,i,u,l,c,d,g,p,m,h){function f(){a.showLoadingBanner(),p.getCurrentEditPostModelFromServer(i.$stateParams.postIndex).success(function(e){i.responseStatusHandler(e),0!=h.calcObjectLength(e.thePost)?(a.editPostModel=p.updateCurrentEditPostModel(e.thePost),d.changeDocumentTitle(a.editPostModel.postHeading),a.showTheEditPostOnly(),a.hideThePager()):(a.editPostModel=p.updateCurrentEditPostModel({}),a.showEditPost=!1,a.showSuggestedPostsOnly(),a.goToTop())}).error(function(e){i.responseStatusHandler(e),a.editPostModel=p.updateCurrentEditPostModel({}),a.showEditPost=!1,a.showSuggestedPostsOnly()})}a.hideThePager(),a.editPostModel=p.getCurrentEditPostModel(),a.showEditPost=!1,a.showTheEditPostOnly=function(){a.hideLoadingBanner(),a.showEditPost=!0,a.hideSuggested()},a.showSuggestedPostsOnly=function(){a.hideLoadingBanner(),a.showEditPost=!1,a.showSuggested()},f(),a.cancelPostUpdate=function(){i.showToast("success","Update cancelled"),s.location.href=r.port()?"http://"+r.host()+":"+r.port()+a.editPostModel.postPath:"http://"+r.host()+a.editPostModel.postPath},a.validateEditForm=function(e){var n=0;return t("validatePostHeading")(a.editPostModel.postHeading,e)||n++,0==n&&(t("validatePostContent")(a.editPostModel.postContent,e)||n++),0==n&&(t("validatePostSummary")(a.editPostModel.postSummary,e)||n++),0==n&&(t("validatePostTags")(a.editPostModel.postTags,e)||n++),0==n},a.submitPostUpdate=function(){a.validateEditForm(!0)&&p.submitPostUpdate(a.editPostModel).success(function(e){i.responseStatusHandler(e),i.showToast("success","Saved"),s.location.href=r.port()?"http://"+r.host()+":"+r.port()+a.editPostModel.postPath:"http://"+r.host()+a.editPostModel.postPath}).error(function(e){i.responseStatusHandler(e)})}}]),angular.module("adminHomeApp").controller("SearchController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","fN",function(e,t,n,o,s,r,a,i,u,l,c,d,g,p,m){function h(){a.showLoadingBanner(),a.mainSearchModel={queryString:i.$stateParams.queryString||"",postSearchUniqueCuid:"",requestedPage:i.$stateParams.pageNumber||1},p.mainSearch(a.mainSearchModel).success(function(e){if(e.results.totalResults>0){var t=e.results;a.mainSearchResultsPosts=p.updateMainSearchResults(t.postsArray),a.mainSearchResultsCount=p.updateMainSearchResultsCount(t.totalResults),a.changePagingTotalCount(a.mainSearchResultsCount),a.changeCurrentPage(t.page),a.mainSearchModel.postSearchUniqueCuid=t.searchUniqueCuid,a.showMainSearchResultsOnly();var n={banner:!0,bannerClass:"alert alert-dismissible alert-success",msg:"The search returned "+a.mainSearchResultsCount+" results"};i.responseStatusHandler(n),a.showThePager()}else{a.mainSearchResultsPosts=p.updateMainSearchResults([]),a.mainSearchResultsCount=p.updateMainSearchResultsCount(0);var o={banner:!0,bannerClass:"alert alert-dismissible alert-success",msg:"The search returned 0 results"};i.responseStatusHandler(o),a.showMainSearchResults=!1,a.showSuggestedPostsOnly(),a.goToTop()}}).error(function(e){i.responseStatusHandler(e),a.mainSearchResultsPosts=p.updateMainSearchResults([]),a.mainSearchResultsCount=p.updateMainSearchResultsCount(0),a.showMainSearchResults=!1,a.showSuggestedPostsOnly()})}a.showThePager(),a.mainSearchModel={queryString:i.$stateParams.queryString||"",postSearchUniqueCuid:"",requestedPage:i.$stateParams.pageNumber||1},d.changeDocumentTitle(i.$stateParams.queryString+" - NegusMath Search"),a.mainSearchResultsPosts=p.getCurrentMainSearchResults(),a.mainSearchResultsCount=0,a.changeCurrentPage=function(e){e!=i.$stateParams.pageNumber},a.suggestedPosts=[],a.showMainSearchResults=!1,a.showSuggestedPosts=!1,a.showMainSearchResultsOnly=function(){a.hideLoadingBanner(),a.showMainSearchResults=!0,a.hideSuggested()},a.showSuggestedPostsOnly=function(){a.hideLoadingBanner(),a.showMainSearchResults=!1,a.showSuggested()},h(),a.checkIfPostsSearchResultsIsEmpty=function(){return 0==a.mainSearchResultsPosts.length},i.$on("reconnect",function(){"home.search"==i.$state.current.name&&h()})}]),angular.module("adminHomeApp").controller("UserManagerController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","logoutService","UserService","$document","fN",function(e,t,n,o,s,r,a,i,u,l,c,d,g,p,m,h){function f(){m.getUsersCountFromServer().success(function(e){a.usersCount=m.updateUsersCount(e.usersCount),i.responseStatusHandler(e)}).error(function(e){i.responseStatusHandler(e)})}a.usersCount=m.getUsersCount(),f(),i.$on("userChanges",function(){f()}),i.$on("reconnect",function(){})}]),angular.module("adminHomeApp").filter("timeago",function(){return function(e,t,n){if(!e)return"never";if(t||(t=Date.now()),angular.isDate(e)?e=e.getTime():"string"==typeof e&&(e=new Date(e).getTime()),angular.isDate(t)?t=t.getTime():"string"==typeof t&&(t=new Date(t).getTime()),"number"==typeof e&&"number"==typeof t){var o=Math.abs((t-e)/1e3),s=[],r=60,a=3600,i=86400,u=604800,l=31556926,c=315569260;return s=r>=o?["",n?"now":"less than a minute"]:60*r>o?[Math.round(Math.abs(o/r)),"min"]:24*a>o?[Math.round(Math.abs(o/a)),"hr"]:7*i>o?[Math.round(Math.abs(o/i)),"day"]:52*u>o?[Math.round(Math.abs(o/u)),"week"]:10*l>o?[Math.round(Math.abs(o/l)),"year"]:100*c>o?[Math.round(Math.abs(o/c)),"decade"]:["","a long time"],s[1]+=0===s[0]||s[0]>1?"s":"",s=s.join(" "),n===!0?s:t>=e?s+" ago":"in "+s}}}).filter("getTimeAgo",["$filter",function(e){return function(t){return e("timeago")(t)}}]).filter("getPostDate",["$filter",function(){return function(e){return moment(e).format("ddd, MMM D, H:mm")}}]).filter("getPostAbsoluteUrl",["$filter",function(){return function(e){return"http://www.negusmath.com/#!/home/post/"+e}}]).filter("getPostPath",["$filter",function(){return function(e){return"/#!/home/post/"+e}}]).filter("makeVideoIframesResponsive",["$filter",function(){return function(e,t){function n(e){return e.postSummary&&(o=$("<div>"+e.postSummary+"</div>"),s=$("img.ta-insert-video",o),s.length>0&&(r=s.addClass("embed-responsive-item").wrap("<div class='embed-responsive embed-responsive-16by9'></div>"),o.find("img").replaceWith(r)),e.postSummary=o.html()),e.postContent&&(o=$("<div>"+e.postContent+"</div>"),s=$("img.ta-insert-video",o),s.length>0&&(r=s.addClass("embed-responsive-item").wrap("<div class='embed-responsive embed-responsive-16by9'></div>"),o.find("img").replaceWith(r)),e.postContent=o.html()),e}var o,s,r;return e?n(e):t?(t.forEach(function(e,o){t[o]=n(e)}),t):void 0}}]).filter("getVideoResponsiveVersion",["$filter",function(){return function(e){function t(e){return n=$("<div>"+e+"</div>"),o=$("img.ta-insert-video",n),o.length>0&&(s=o.addClass("embed-responsive-item").wrap("<div class='embed-responsive embed-responsive-16by9'></div>"),n.find("img").replaceWith(s)),n.html()}var n,o,s;return e?t(e):e}}]).filter("highlightText",["$filter","$rootScope",function(e,t){return function(e,n){function o(){return"home.search"==t.$state.current.name?{status:!0,queryString:t.$stateParams.queryString||""}:t.stateHistory.length>0&&t.stateHistory[t.stateHistory.length-1].hasOwnProperty("home.search")?{status:!0,queryString:t.stateHistory[t.stateHistory.length-1]["home.search"].queryString}:{status:!1}}function s(e){if(n){var t=e,s=o();if(s.status===!0){var r=$("<div>"+e+"</div>");$(r).highlight(s.queryString),t=r.html()}else{var a=$("<div>"+e+"</div>");$(a).removeHighlight(),t=a.html()}}else{var i=$("<div>"+e+"</div>");$(i).removeHighlight(),t=i.html()}return t}return s(e)}}]).filter("preparePosts",["$filter",function(e){return function(t,n){function o(t){return t.forEach(function(n,o){t[o].text=e("highlightText")(n.text,!0)}),t}function s(t){return t.timeAgo=e("getTimeAgo")(t.createdAt),t.postDate=e("getPostDate")(t.createdAt),t.postAbsoluteUrl=e("getPostAbsoluteUrl")(t.postIndex),t.postPath=e("getPostPath")(t.postIndex),t.postHeading=e("highlightText")(t.postHeading,!0),t.authorName=e("highlightText")(t.authorName,!0),t.postSummary=e("highlightText")(e("getVideoResponsiveVersion")(t.postSummary),!0),t.postContent=e("highlightText")(e("getVideoResponsiveVersion")(t.postContent),!0),t.postTags=o(t.postTags),t}return t?s(t):n?(n.forEach(function(e,t){n[t]=s(e)}),n):void 0}}]).filter("removeHighlights",["$filter",function(e){return function(t,n){function o(t){return t.forEach(function(n,o){t[o].text=e("highlightText")(n.text,!1)}),t}function s(t){return t.timeAgo=e("getTimeAgo")(t.createdAt),t.postDate=e("getPostDate")(t.createdAt),t.postAbsoluteUrl=e("getPostAbsoluteUrl")(t.postIndex),t.postPath=e("getPostPath")(t.postIndex),t.postHeading=e("highlightText")(t.postHeading,!1),t.authorName=e("highlightText")(t.authorName,!1),t.postSummary=e("highlightText")(t.postSummary,!1),t.postContent=e("highlightText")(t.postContent,!1),t.postTags=o(t.postTags),t}return t?s(t):n?(n.forEach(function(e,t){n[t]=s(e)}),n):void 0}}]).filter("preparePostsNoChange",["$filter",function(e){return function(t,n){function o(t){return t.timeAgo=e("getTimeAgo")(t.createdAt),t.postDate=e("getPostDate")(t.createdAt),t.postAbsoluteUrl=e("getPostAbsoluteUrl")(t.postIndex),t.postPath=e("getPostPath")(t.postIndex),t}return t?o(t):n?(n.forEach(function(e,t){n[t]=o(e)}),n):void 0}}]).filter("responseFilter",["$q","$filter","$log","$interval","$window","$location","$rootScope","globals",function(e,t,n,o,s,r,a,i){return function(e){function t(e,t,n){return{show:e?!0:!1,bannerClass:t,msg:n}}return e&&(e.redirect&&e.redirect&&(s.location.href=e.redirectPage),e.notify&&e.type&&e.msg&&a.showToast(e.type,e.msg),e.banner&&e.bannerClass&&e.msg&&a.$broadcast("universalBanner",t(!0,e.bannerClass,e.msg)),e.newPostBanner&&e.bannerClass&&e.msg&&a.$broadcast("newPostBanner",t(!0,e.bannerClass,e.msg)),e.registrationBanner&&e.bannerClass&&e.msg&&a.$broadcast("registrationBanner",t(!0,e.bannerClass,e.msg)),e.reason&&n.warn(e.reason)),!0}}]),angular.module("adminHomeApp").filter("validatePostHeading",["$filter","$rootScope",function(e,t){return function(e,n){function o(e,o){n&&t.showToast(e,o)}var s=0;return e?(0==e.length&&(s++,o("warning","The heading is required")),0==s&&e.length<10&&(o("warning","The minimum required length of the heading is 10 characters"),s++)):(s++,o("warning","The heading is required")),0==s}}]).filter("postHeadingMessages",["$filter","$rootScope",function(e,t){return function(e){function t(e){n?n=n+": "+e:n+=e}var n="";if(e){var o=$("<div>"+e+"</div>").text();0==o.length&&t("The is a required field"),o.length>0&&o.length<10&&t("Minimum length required is 10 characters")}else t("The is a required field");return n}}]).filter("validatePostContent",["$filter","$rootScope",function(e,t){return function(e,n){function o(e,o){n&&t.showToast(e,o)}if(e){var s=$("<div>"+e+"</div>").text();return 0==s.length&&o("warning","Please add some text to the post first"),s.length>0}return o("warning","Please add some text to the post first"),!1}}]).filter("postContentMessages",["$filter","$rootScope",function(e,t){return function(e){if(e){var t=$("<div>"+e+"</div>").text();return 0==t.length?"This is a required field":""}return"This is a required field"}}]).filter("validatePostSummary",["$filter","$rootScope",function(e,t){return function(e,n){function o(e,o){n&&t.showToast(e,o)}var s=0;if(e){var r=$("<div>"+e+"</div>").text();0==r.length&&(s++,o("warning","The post summary cannot be empty")),0==s&&r.length>2e3&&(s++,o("warning","The post summary cannot exceed 2000 characters"))}else s++,o("warning","The post summary cannot be empty");return 0==s}}]).filter("postSummaryMessages",["$filter","$rootScope",function(e,t){return function(e){function t(e){n?n=n+": "+e:n+=e}var n="";if(e){var o=$("<div>"+e+"</div>").text();0==o.length&&t("The post summary cannot be empty"),o.length>2e3&&t("The post summary cannot exceed 2000 characters")}else t("The post summary cannot be empty");return n}}]).filter("validatePostTags",["$filter","$rootScope",function(e,t){return function(e,n){function o(e,o){n&&t.showToast(e,o)}var s=0,r=0;return e?(e.forEach(function(e){r++,e&&e.text&&(0==s&&e.text.length<3&&(s++,o("warning","Minimum required length for each tag is 3 characters")),0==s&&e.text.length>30&&(s++,o("warning","Maximum allowed length for each tag is 30 characters")))}),0==s&&r>5&&(s++,o("warning","Only a maximum of 5 tags are allowed per post")),0==s):!0}}]).filter("postTagsMessages",["$filter","$rootScope",function(e,t){return function(e){function t(e){n?n=n+": "+e:n+=e}var n="",o=0;return e&&(e.forEach(function(e){o++,e&&e.text&&(e.text.length<3&&t("Minimum required length for each tag is 3 characters"),e.text.length>30&&t("Maximum allowed length for each tag is 30 characters"))}),o>5&&t("Only a maximum of 5 tags are allowed per post")),n}}]),angular.module("adminHomeApp").factory("fN",["$q","$location","$window","$rootScope","socketService",function(e,t,n,o,s){return{calcObjectLength:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t}}}]),angular.module("adminHomeApp").factory("globals",["$q","$location","$window","$rootScope","socketService",function(e,t,n,o,s){var r={},a={documentTitle:"Negus Math - College Level Advanced Mathematics for Kenya Students",indexPageUrl:t.port()?"http://"+t.host()+":"+t.port()+"/index":$scope.indexPageUrl="http://"+t.host()+"/index"};return{userData:function(e){return e?r=e:r},allData:a,getDocumentTitle:function(){return a.documentTitle},defaultDocumentTitle:function(){a.documentTitle="Negus Math - College Level Advanced Mathematics for Kenya Students"},changeDocumentTitle:function(e){return e&&(a.documentTitle=e),a.documentTitle}}}]),angular.module("adminHomeApp").factory("HotService",["$filter","$log","$http","$window","$rootScope","socket",function(e,t,n,o,s,r){var a=[];return r.on("hotThisWeekPosts",function(e){s.$broadcast("hotThisWeekPosts",e)}),{getHotThisWeek:function(){return a},getHotThisWeekFromServer:function(){return n.post("/api/getHotThisWeek",{})},updateHotThisWeek:function(t){return a=t==[]?[]:e("preparePosts")(null,t),t}}}]),angular.module("adminHomeApp").factory("mainService",["$log","$window","$rootScope","socket","socketService","globals",function(e,t,n,o,s,r){return o.on("reconnect",function(){e.info("'reconnect sequence' triggered"),n.$broadcast("reconnect")}),{done:function(){return 1}}}]),angular.module("adminHomeApp").factory("PostService",["$filter","$http","$window","$rootScope","$interval","socket",function(e,t,n,o,s,r){var a={},i={},u=[],l=0,c=[],d=0,g=[];return r.on("newPost",function(e){o.$broadcast("newPost",e)}),r.on("postUpdate",function(e){o.$broadcast("postUpdate",e)}),{getCurrentPosts:function(){return u},getCurrentPostsCount:function(){return l},getPostsFromServer:function(e){return t.post("/api/getPosts",{page:e})},updatePosts:function(t){return u=t==[]?[]:e("preparePosts")(null,t)},updatePostsCount:function(e){return l=e},addNewToPosts:function(t){function n(n){return n=t=={}?{}:e("preparePosts")(n,null)}var o=n(t);return u.unshift(o),u},getCurrentPost:function(){return a},getPostFromServer:function(e){return t.post("/api/getPost",{postIndex:e})},updatePost:function(t){return a=t=={}?{}:e("preparePosts")(t,null)},getCurrentEditPostModel:function(){return i=={}?{}:i},getCurrentEditPostModelFromServer:function(e){return t.post("/api/getPost",{postIndex:e})},updateCurrentEditPostModel:function(t){return i=t=={}?{}:e("preparePostsNoChange")(t,null)},getCurrentMainSearchResults:function(){return c},mainSearch:function(e){return t.post("/api/mainSearch",e)},updateMainSearchResults:function(t){return c=t==[]?[]:e("preparePosts")(null,t)},updateMainSearchResultsCount:function(e){return d=e},getSuggestedPosts:function(){return g},getSuggestedPostsFromServer:function(){return t.post("/api/getSuggestedPosts",{})},updateSuggestedPosts:function(t){return g=t==[]?[]:e("preparePosts")(null,t)},submitNewPost:function(e){return t.post("/api/newPost",{newPost:e})},submitPostUpdate:function(e){return t.post("/api/updatePost",{postUpdate:e})}}}]),angular.module("adminHomeApp").factory("socket",["$log","$location","$rootScope",function(e,t,n){var o;o=t.port()?t.host()+":"+t.port():t.host();var s=io.connect(o);return{on:function(e,t){s.on(e,function(){var e=arguments;n.$apply(function(){t.apply(s,e)})})},emit:function(e,t,o){s.emit(e,t,function(){var e=arguments;n.$apply(function(){o&&o.apply(s,e)})})},removeAllListeners:function(e,t){s.removeAllListeners(e,function(){var e=arguments;n.$apply(function(){t.apply(s,e)})})}}}]).factory("socketService",["$log","$http","$rootScope",function(e,t,n){return{getUserData:function(){return t.get("/api/getUserData")},resendConfirmationEmail:function(){return t.post("/resendConfirmationEmail")},sendContactUs:function(e){return t.post("/contactUs",e)}}}]).factory("logoutService",["$http",function(e){return{logoutClient:function(){return e.post("/api/logoutClient")}}}]),angular.module("adminHomeApp").factory("UserService",["$filter","$http","$window","$rootScope","$interval","socket",function(e,t,n,o,s,r){var a={},i=[],u=[],l=[],c=[];return{getUsersCount:function(){return a},getUsersCountFromServer:function(){return t.post("/api/getUsersCount",{})},updateUsersCount:function(e){return a=e},getAllUsers:function(){return i},getAllUsersFromServer:function(){return t.post("/api/getAllUsers",{})},updateAllUsers:function(e){return i=e},getAdminUsers:function(){return u},getAdminUsersFromServer:function(){return t.post("/api/getAdminUsers",{})},updateAdminUsers:function(e){return u=e},getUsersNotApproved:function(){return l},getUsersNotApprovedFromServer:function(){return t.post("/api/getUsersNotApproved",{})},updateUsersNotApproved:function(e){return l=e},getBannedUsers:function(){return c},getBannedUsersFromServer:function(){return t.post("/api/getBannedUsers",{})},updateBannedUsers:function(e){return c=e},addAdminPrivileges:function(e){return t.post("/api/addAdminPrivileges",{userUniqueCuid:e})},removeAdminPrivileges:function(e){return t.post("/api/removeAdminPrivileges",{userUniqueCuid:e})},approveUser:function(e){return t.post("/api/approveUser",{userUniqueCuid:e})},banUser:function(e){return t.post("/api/banUser",{userUniqueCuid:e})},unBanUser:function(e){return t.post("/api/unBanUser",{userUniqueCuid:e})}}}]),angular.module("adminHomeApp").directive("accountStatusBanner",["$rootScope","socketService","globals",function(e,t,n){return{scope:{},templateUrl:"views/general/smalls/account_status.html",restrict:"AE",link:function(n,o,s){function r(){t.getUserData().success(function(e){1==e.userData.isRegistered&&(n.accountStatusBanner=a(e.userData),i(e.userData))}).error(function(){n.accountStatusBanner={show:!0,bannerClass:"alert alert-warning",msg:"An error has occurred. Please reload page"}})}function a(e){return console.log(JSON.stringify(e.emailIsConfirmed)),e.isRegistered?e.emailIsConfirmed?e.isApproved===!1?{show:!0,bannerClass:"alert alert-warning",msg:"Your account is awaiting approval from the administrators. Please allow up to 3 business days. You will get an email notification as soon as your account is approved.",showResendEmail:!1}:e.isBanned&&e.isBanned.status===!0?{show:!0,bannerClass:"alert alert-warning",msg:"Your have been banned from this service. Please contact the administrators for more information",showResendEmail:!1}:{show:!1,bannerClass:"",msg:"",showResendEmail:!1}:{show:!0,bannerClass:"alert alert-warning",msg:"Please confirm your account by clicking the confirmation link we sent on your email. Please also check your spam folder",showResendEmail:!0}:{show:!1,bannerClass:"",msg:"",showResendEmail:!1}}function i(e){n.checkAccount(e)||($window.location.href=$location.port()?"http://"+$location.host()+":"+$location.port()+"/index":"http://"+$location.host()+"/index")}n.accountStatusBanner={show:!1,bannerClass:"",msg:"",showResendEmail:!1},n.resendConfirmationEmail=function(){t.resendConfirmationEmail().success(function(t){e.responseStatusHandler(t)}).error(function(t){e.responseStatusHandler(t)})},r(),n.checkAccount=function(e){return e&&e.isRegistered&&e.emailIsConfirmed&&e.isApproved&&e.isBanned.status?!0:!1},e.$on("userDataChanges",function(){}),e.$on("reconnect",function(){r()})}}}]).directive("universalBanner",["$rootScope",function(e){return{templateUrl:"views/admin/partials/smalls/universal_banner.html",restrict:"AE",link:function(t,n,o){t.universalBanner={show:!1,bannerClass:"",msg:""},e.$on("universalBanner",function(e,n){t.universalBanner=n}),e.$on("clearBanners",function(){t.universalBanner={show:!1,bannerClass:"",msg:""}})}}}]).directive("newPostBanner",["$rootScope",function(e){return{templateUrl:"views/admin/partials/smalls/new_post_banner.html",restrict:"AE",link:function(t,n,o){t.newPostBanner={show:!1,bannerClass:"",msg:""},e.$on("newPostBanner",function(e,n){t.newPostBanner=n}),e.$on("clearBanners",function(){t.newPostBanner={show:!1,bannerClass:"",msg:""}})}}}]).directive("toastrDirective",["$rootScope",function(e){return{restrict:"AE",link:function(t,n,o){e.showToast=function(e,t){switch(e){case"success":toastr.clear(),toastr.success(t);break;case"warning":toastr.clear(),toastr.warning(t,"Warning",{closeButton:!0,tapToDismiss:!0});break;case"error":toastr.clear(),toastr.error(t,"Error",{closeButton:!0,tapToDismiss:!0,timeOut:!1});break;default:toastr.clear()}},e.clearToasts=function(){toastr.clear()}}}}]).directive("loadingBanner",["$rootScope",function(e){var t=["$scope","$rootScope","cfpLoadingBar",function(e,t,n){t.isLoading=!0,t.isLoadingPercentage=0,t.changeIsLoadingPercentage=function(e){t.isLoadingPercentage=e},t.showHideLoadingBanner=function(e){e?($("#loading-splash-card").removeClass("hidden"),$(".hideMobileLoading").addClass("hidden-xs hidden-sm")):($("#loading-splash-card").addClass("hidden"),$(".hideMobileLoading").removeClass("hidden-xs hidden-sm"))},t.$on("cfpLoadingBar:loading",function(e,o){t.isLoadingPercentage=100*n.status()}),t.$on("cfpLoadingBar:loaded",function(e,o){t.isLoadingPercentage=100*n.status()}),t.$on("cfpLoadingBar:completed",function(e,o){t.isLoadingPercentage=100*n.status()}),t.isLoadingTrue=function(){t.isLoading=!0},t.isLoadingFalse=function(){t.isLoading=!1},t.$on("isLoadingTrue",function(){t.isLoading=!0}),t.$on("isLoadingFalse",function(){t.isLoading=!1})}];return{templateUrl:"views/admin/partials/smalls/loading_banner.html",restrict:"AE",controller:t}}]),angular.module("adminHomeApp").directive("titleDirective",["globals",function(e){return{template:'<title ng-bind="defaultTitle"></title>',restrict:"AE",link:function(t,n,o){t.defaultTitle=e.getDocumentTitle(),t.$watch(e.getDocumentTitle,function(){t.defaultTitle=e.getDocumentTitle()})}}}]).directive("universalSearchBox",["$window","$location","$rootScope","globals",function(e,t,n,o){return{templateUrl:"views/admin/partials/smalls/universal_search_box.html",restrict:"AE",link:function(o,s,r){o.mainSearchModel={queryString:"",postSearchUniqueCuid:"",requestedPage:1},o.fillSearchBox=function(){o.mainSearchModel.queryString="home.search"==n.$state.current.name?n.$stateParams.queryString?n.$stateParams.queryString:"":n.stateHistory.length>0&&n.stateHistory[n.stateHistory.length-1].hasOwnProperty("search")?n.stateHistory[n.stateHistory.length-1].search.queryString:""},o.fillSearchBox(),o.performMainSearch=function(){o.mainSearchModel.queryString.length>0&&(e.location.href=t.port()?"http://"+t.host()+":"+t.port()+"/#!/home/search/"+o.mainSearchModel.queryString+"/1":"http://"+t.host()+"/#!/home/search/"+o.mainSearchModel.queryString+"/1")}}}}]).directive("topNav",["$rootScope","logoutService",function(e,t){return{templateUrl:"views/admin/partials/views/top_nav.html",restrict:"AE",link:function(n,o,s){n.logoutClient=function(){t.logoutClient().success(function(t){e.responseStatusHandler(t)}).error(function(t){e.responseStatusHandler(t)})}}}}]).directive("postStream",["$q","$filter","$log","$interval","$window","$location","$rootScope","socket","mainService","socketService","globals","$modal","PostService",function(e,t,n,o,s,r,a,i,u,l,c,d,g){return{templateUrl:"views/admin/partials/smalls/post_feed.html",restrict:"AE",link:function(e,t,n){function o(){e.showLoadingBanner(),g.getPostsFromServer(a.$stateParams.pageNumber||1).success(function(t){if(0==t.postsArray.length){e.posts=g.updatePosts([]);var n={banner:!0,bannerClass:"alert alert-dismissible alert-success",msg:"No more posts to show"};a.responseStatusHandler(n),e.mainSearchResultsPosts=!1,e.showSuggestedPostsOnly(),e.goToTop()}else e.posts=g.updatePosts(t.postsArray),e.showThePostsOnly(),t.postsCount&&(e.postsCount=t.postsCount,e.changePagingTotalCount(e.postsCount)),e.showThePager()}).error(function(t){a.responseStatusHandler(t),e.posts=g.updatePosts([]),e.mainSearchResultsPosts=!1,e.showSuggestedPostsOnly()})}e.showThePager(),c.defaultDocumentTitle(),e.posts=g.getCurrentPosts(),e.postsCount=g.getCurrentPostsCount(),e.suggestedPosts=g.getSuggestedPosts(),e.mainSearchResultsPosts=!1,e.showThePostsOnly=function(){e.hideLoadingBanner(),e.mainSearchResultsPosts=!0,e.hideSuggested()},e.showSuggestedPostsOnly=function(){e.hideLoadingBanner(),e.mainSearchResultsPosts=!1,e.showSuggested()},o(),a.$on("newPost",function(t,n){1==a.$stateParams.pageNumber&&(e.posts=g.addNewToPosts(n.post)),n.postsCount&&(e.postsCount=n.postsCount,e.changePagingTotalCount(e.postsCount))}),a.$on("reconnect",function(){("home"==a.$state.current.name||"home.stream"==a.$state.current.name)&&o()})}}}]).directive("suggestedPosts",["$rootScope","PostService",function(e,t){return{templateUrl:"views/admin/partials/smalls/suggested_posts.html",restrict:"AE",link:function(n,o,s){function r(){n.showLoadingBanner(),t.getSuggestedPostsFromServer().success(function(e){e.postsArray.length>0?(n.suggestedPosts=t.updateSuggestedPosts(e.postsArray),n.hideLoadingBanner()):(n.suggestedPosts=[],n.showSuggestedPosts=!1,n.goToTop(),n.hideLoadingBanner())}).error(function(o){n.goToTop(),n.suggestedPosts=t.updateSuggestedPosts([]),n.showSuggestedPosts=!1,e.responseStatusHandler(o),n.hideLoadingBanner()}),n.hideThePager()}n.suggestedPosts=t.getSuggestedPosts(),n.showSuggestedPosts=!1,e.showHideSuggestedPosts=function(e){e?(n.showSuggestedPosts=!0,r()):n.showSuggestedPosts=!1},r()}}}]).directive("pagerDirective",["$window","$location","$rootScope","globals",function(e,t,n,o){return{templateUrl:"views/admin/partials/smalls/pager.html",restrict:"AE",link:function(e,t,o){e.showPaging=!1,n.showThePager=function(t){e.showPaging=t?!0:!0},n.hideThePager=function(){e.showPaging=!1},e.pagingMaxSize=5,e.numPages=5,e.itemsPerPage=10,e.pagingTotalCount=1,n.changePagingTotalCount=function(t){e.pagingTotalCount=t},e.currentPage=n.$stateParams.pageNumber,n.$on("$stateChangeSuccess",function(t,o,s,r,a){
r.name!=o.name&&"home"!=n.$state.current.name&&(e.currentPage=n.$stateParams.pageNumber)}),e.goToPage=function(){console.log(e.currentPage),"home"==n.$state.current.name?n.$state.go("home.stream",{pageNumber:e.currentPage}):n.$state.go(n.$state.current.name,{pageNumber:e.currentPage}),e.goToTop()}}}}]).directive("contactUs",["globals",function(e){return{templateUrl:"views/admin/partials/smalls/contact_us.html",restrict:"AE",link:function(e,t,n){}}}]).directive("mainFooter",["globals",function(e){return{templateUrl:"views/admin/partials/smalls/main_footer.html",restrict:"AE",link:function(e,t,n){}}}]),angular.module("adminHomeApp").directive("newPostDirective",["$filter","$rootScope","globals","PostService",function(e,t,n,o){return{templateUrl:"views/admin/partials/smalls/new_post.html",restrict:"AE",link:function(n,s,r){n.newPost=!1,n.showNewPost=function(){n.newPost=!0},t.showNewPost=function(){n.showNewPost()},n.hideNewPost=function(){n.newPost=!1},t.hideNewPost=function(){n.hideNewPost()},n.newPostModel={postHeading:"",postContent:"",postSummary:"",postTags:[]},n.validateForm=function(t){console.log(t);var o=0;return e("validatePostHeading")(n.newPostModel.postHeading,t)||o++,0==o&&(e("validatePostContent")(n.newPostModel.postContent,t)||o++),0==o&&(e("validatePostSummary")(n.newPostModel.postSummary,t)||o++),0==o&&(e("validatePostTags")(n.newPostModel.postTags,t)||o++),0==o},n.submitNewPost=function(){if(n.validateForm(!0)){var e={postHeading:n.newPostModel.postHeading,postContent:n.newPostModel.postContent,postSummary:n.newPostModel.postSummary,postTags:n.newPostModel.postTags};o.submitNewPost(e).success(function(e){n.hideNewPost(),t.responseStatusHandler(e),n.newPostModel.postHeading="",n.newPostModel.postContent="",n.newPostModel.postSummary="",n.newPostModel.postTags=[]}).error(function(e){t.responseStatusHandler(e)})}}}}}]),angular.module("adminHomeApp").directive("headingMessages",["$filter",function(e){return{template:'<span class="form-error-notice" ng-show="showSpan()"><small ng-bind="postHeading | postHeadingMessages"></small></span>',restrict:"AE",scope:{postHeading:"=model"},link:function(t,n,o){t.showSpan=function(){return!e("validatePostHeading")(t.postHeading)}}}}]).directive("contentMessages",["$filter",function(e){return{template:'<span class="form-error-notice" ng-show="showSpan()"><small ng-bind="postContent | postContentMessages"></small></span>',restrict:"AE",scope:{postContent:"=model"},link:function(t,n,o){t.showSpan=function(){return!e("validatePostContent")(t.postContent)}}}}]).directive("summaryMessages",["$filter",function(e){return{template:'<span class="form-error-notice" ng-show="showSpan()"><small ng-bind="postSummary | postSummaryMessages"></small></span>',restrict:"AE",scope:{postSummary:"=model"},link:function(t,n,o){t.showSpan=function(){return!e("validatePostSummary")(t.postSummary)}}}}]).directive("tagMessages",["$filter",function(e){return{template:'<span class="form-error-notice" ng-show="showSpan()"><small ng-bind="postTags | postTagsMessages"></small></span>',restrict:"AE",scope:{postTags:"=model"},link:function(t,n,o){t.showSpan=function(){return!e("validatePostTags")(t.postTags)}}}}]),angular.module("adminHomeApp").directive("postContent",["$filter","$rootScope","globals","PostService",function(e,t,n,o){return{templateUrl:"views/admin/partials/smalls/post_content.html",scope:{postContent:"=model"},restrict:"AE",link:function(e,t,n){}}}]).directive("postSummary",["$filter","$rootScope","globals","PostService",function(e,t,n,o){return{templateUrl:"views/admin/partials/smalls/post_summary.html",scope:{postSummary:"=model"},restrict:"AE",link:function(e,t,n){}}}]).directive("postTags",["$filter","$rootScope","globals","PostService",function(e,t,n,o){return{templateUrl:"views/admin/partials/smalls/post_tags.html",scope:{postTags:"=model"},restrict:"AE",link:function(e,t,n){}}}]),angular.module("adminHomeApp").directive("adminUsers",["$q","$filter","$log","$interval","$window","$location","$rootScope","socket","mainService","socketService","globals","$modal","UserService",function(e,t,n,o,s,r,a,i,u,l,c,d,g){return{templateUrl:"views/admin/partials/smalls/users/admin_users.html",restrict:"AE",link:function(e,t,n){function o(){g.getAdminUsersFromServer().success(function(t){e.adminUsers=g.updateAdminUsers(t.usersArray),a.responseStatusHandler(t)}).error(function(e){a.responseStatusHandler(e)})}e.adminUsersModel={filterString:""},e.adminUsers=g.getAdminUsers(),o(),a.$on("userChanges",function(){o()}),a.$on("reconnect",function(){})}}}]),angular.module("adminHomeApp").directive("allUsers",["$q","$filter","$log","$interval","$window","$location","$rootScope","socket","mainService","socketService","globals","$modal","UserService",function(e,t,n,o,s,r,a,i,u,l,c,d,g){return{templateUrl:"views/admin/partials/smalls/users/all_users.html",restrict:"AE",link:function(e,t,n){function o(){g.getAllUsersFromServer().success(function(t){e.allUsers=g.updateAllUsers(t.usersArray),a.responseStatusHandler(t)}).error(function(e){a.responseStatusHandler(e)})}e.allUsersModel={filterString:""},e.allUsers=g.getAllUsers(),o(),a.$on("userChanges",function(){o()}),a.$on("reconnect",function(){})}}}]),angular.module("adminHomeApp").directive("bannedUsers",["$q","$filter","$log","$interval","$window","$location","$rootScope","socket","mainService","socketService","globals","$modal","UserService",function(e,t,n,o,s,r,a,i,u,l,c,d,g){return{templateUrl:"views/admin/partials/smalls/users/banned_users.html",restrict:"AE",link:function(e,t,n){function o(){g.getBannedUsersFromServer().success(function(t){e.bannedUsers=g.updateBannedUsers(t.usersArray),a.responseStatusHandler(t)}).error(function(e){a.responseStatusHandler(e)})}e.bannedUsersModel={filterString:""},e.bannedUsers=g.getBannedUsers(),o(),a.$on("userChanges",function(){o()}),a.$on("reconnect",function(){})}}}]),angular.module("adminHomeApp").directive("unApprovedUsers",["$q","$filter","$log","$interval","$window","$location","$rootScope","socket","mainService","socketService","globals","$modal","UserService",function(e,t,n,o,s,r,a,i,u,l,c,d,g){return{templateUrl:"views/admin/partials/smalls/users/unApproved_users.html",restrict:"AE",link:function(e,t,n){function o(){g.getUsersNotApprovedFromServer().success(function(t){e.usersNotApproved=g.updateUsersNotApproved(t.usersArray),a.responseStatusHandler(t)}).error(function(e){a.responseStatusHandler(e)})}e.usersNotApprovedModel={filterString:""},e.usersNotApproved=g.getUsersNotApproved(),o(),a.$on("userChanges",function(){o()}),a.$on("reconnect",function(){})}}}]),angular.module("adminHomeApp").directive("userDisplay",["$filter","$rootScope","UserService",function(e,t,n){return{templateUrl:"views/admin/partials/smalls/users/user_display.html",restrict:"AE",scope:{user:"="},link:function(e,o,s){e.isCollapsed=!0,e.addAdminPrivileges=function(e){n.addAdminPrivileges(e).success(function(e){t.$broadcast("userChanges"),t.responseStatusHandler(e)}).error(function(e){t.responseStatusHandler(e)})},e.removeAdminPrivileges=function(e){n.removeAdminPrivileges(e).success(function(e){t.$broadcast("userChanges"),t.responseStatusHandler(e)}).error(function(e){t.responseStatusHandler(e)})},e.approveUser=function(e){n.approveUser(e).success(function(e){t.$broadcast("userChanges"),t.responseStatusHandler(e)}).error(function(e){t.responseStatusHandler(e)})},e.banUser=function(e){n.banUser(e).success(function(e){t.$broadcast("userChanges"),t.responseStatusHandler(e)}).error(function(e){t.responseStatusHandler(e)})},e.unBanUser=function(e){n.unBanUser(e).success(function(e){t.$broadcast("userChanges"),t.responseStatusHandler(e)}).error(function(e){t.responseStatusHandler(e)})}}}}]),angular.module("adminHomeApp").directive("usersCount",["$q","$filter","$log","$interval","$window","$location","$rootScope","socket","mainService","socketService","globals","$modal","UserService",function(e,t,n,o,s,r,a,i,u,l,c,d,g){return{templateUrl:"views/admin/partials/smalls/users/user_statistics.html",restrict:"AE",link:function(e,t,n){a.$on("userChanges",function(){})}}}]);
//# sourceMappingURL=concatenated.min.js.map