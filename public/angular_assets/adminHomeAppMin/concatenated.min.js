angular.module("adminHomeApp",["ui.bootstrap","angular-loading-bar","cfp.loadingBar","angulartics","angulartics.google.analytics","angularMoment","ui.router","duScroll","ngFx","ngAnimate","textAngular","ngSanitize","angularUtils.directives.dirDisqus"]).run(["$templateCache","$http",function(t,e){e.get("views/admin/partials/views/post_stream.html",{cache:t}),e.get("views/admin/partials/views/full_post.html",{cache:t})}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,o){e.otherwise("/home/1"),t.state("home",{url:"/home/:pageNumber",templateUrl:"views/admin/partials/views/post_stream.html"}).state("post",{url:"/post/:postIndex",templateUrl:"views/admin/partials/views/full_post.html"}).state("otherwise",{url:"/home/1"}),o.html5Mode(!1).hashPrefix("!")}]),angular.module("adminHomeApp").filter("timeago",function(){return function(t,e,o){if(!t)return"never";if(e||(e=Date.now()),angular.isDate(t)?t=t.getTime():"string"==typeof t&&(t=new Date(t).getTime()),angular.isDate(e)?e=e.getTime():"string"==typeof e&&(e=new Date(e).getTime()),"number"==typeof t&&"number"==typeof e){var s=Math.abs((e-t)/1e3),n=[],a=60,r=3600,i=86400,u=604800,c=31556926,l=315569260;return n=a>=s?["",o?"now":"less than a minute"]:60*a>s?[Math.round(Math.abs(s/a)),"min"]:24*r>s?[Math.round(Math.abs(s/r)),"hr"]:7*i>s?[Math.round(Math.abs(s/i)),"day"]:52*u>s?[Math.round(Math.abs(s/u)),"week"]:10*c>s?[Math.round(Math.abs(s/c)),"year"]:100*l>s?[Math.round(Math.abs(s/l)),"decade"]:["","a long time"],n[1]+=0===n[0]||n[0]>1?"s":"",n=n.join(" "),o===!0?n:e>=t?n+" ago":"in "+n}}}),angular.module("adminHomeApp").controller("HotController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","$stateParams","HotService",function(t,e,o,s,n,a,r,i,u,c,l,d,g,m,p,f){function h(){f.getHotThisWeekFromServer().success(function(t){r.hotThisWeek=f.updateHotThisWeek(t.hotThisWeek),P()}).error(function(t){r.responseStatusHandler(t)})}function P(){r.hotThisWeek.forEach(function(t){t.theTimeAgo=e("timeago")(t.createdAt),t.postDate=moment(t.createdAt).format("ddd, MMM D, H:mm")})}r.hotThisWeek=f.getHotThisWeek(),h(),s(P,12e4,0,!0),P(),i.$on("reconnect",function(){h()}),o.info("PostController booted successfully")}]),angular.module("adminHomeApp").controller("MainController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","logoutService","PostService","$document","$state","$stateParams","cfpLoadingBar",function(t,e,o,s,n,a,r,i,u,c,l,d,g,m,p,f,h,P,w){i.$on("$stateChangeSuccess",function(t,e,o,s,n){r.currentState=e.name});var S=[];i.$on("$routeChangeSuccess",function(){S.push(a.$$path)}),i.back=function(){var t=S.length>1?S.splice(-2)[0]:"/";a.path(t)},r.calcObjectLength=function(t){var e=0;for(var o in t)t.hasOwnProperty(o)&&e++;return e};var v=0;r.goToTop=function(){var t=angular.element(document.getElementById("top"));f.scrollToElement(t,80,v)},r.goToUniversalBanner=function(){var t=angular.element(document.getElementById("universalBanner"));f.scrollToElement(t,80,v)},r.makeVideoIframesResponsive=function(t){var e=$("<div>"+t+"</div>"),o=$("img.ta-insert-video",e);if(o.length>0){var s=o.addClass("embed-responsive-item").wrap("<div class='embed-responsive embed-responsive-16by9'></div>");e.find("img").replaceWith(s)}return e.html()},r.clientIsRegistered=!1,r.universalDisable=!1,r.showBanner=!1,r.bannerClass="",r.bannerMessage="",r.showRegistrationBanner=!1,r.registrationBannerClass="",r.registrationBannerMessage="",r.showNewPostBanner=!1,r.newPostBannerClass="",r.newPostBannerMessage="",r.clearBanners=function(){r.showBanner=!1,r.showRegistrationBanner=!1,r.showNewPostBanner=!1},i.$on("$stateChangeSuccess",function(t,e,o,s,n){r.clearBanners()}),r.universalDisableTrue=function(){r.universalDisable=!0},r.universalDisableFalse=function(){r.universalDisable=!1},r.responseStatusHandler=function(t){t&&(t.redirect&&t.redirect&&(n.location.href=t.redirectPage),t.disable&&t.disable&&r.universalDisableTrue(),t.notify&&t.type&&t.msg&&r.showToast(t.type,t.msg),t.banner&&t.bannerClass&&t.msg&&(r.showBanner=!0,r.bannerClass=t.bannerClass,r.bannerMessage=t.msg),t.newPostBanner&&t.bannerClass&&t.msg&&(r.showNewPostBanner=!0,r.newPostBannerClass=t.bannerClass,r.newPostBannerMessage=t.msg),t.registrationBanner&&t.bannerClass&&t.msg&&(r.showRegistrationBanner=!0,r.registrationBannerClass=t.bannerClass,r.registrationBannerMessage=t.msg),t.reason&&o.warn(t.reason))},i.$on("responseStatusHandler",function(t,e){r.responseStatusHandler(e)}),r.isLoading=!1,r.isLoadingPercentage=0,r.changeIsLoadingPercentage=function(t){r.isLoadingPercentage=t},r.showHideLoadingBanner=function(t){t?$("#loading-splash-card").removeClass("hidden"):$("#loading-splash-card").addClass("hidden")},i.$on("cfpLoadingBar:loading",function(t,e){r.isLoadingPercentage=100*w.status()}),i.$on("cfpLoadingBar:loaded",function(t,e){r.isLoadingPercentage=100*w.status()}),i.$on("cfpLoadingBar:completed",function(t,e){r.isLoadingPercentage=100*w.status()}),r.isLoadingTrue=function(){r.isLoading=!0},r.isLoadingFalse=function(){r.isLoading=!1},i.$on("isLoadingTrue",function(){r.isLoading=!0}),i.$on("isLoadingFalse",function(){r.isLoading=!1}),r.showToast=function(t,e){switch(t){case"success":toastr.clear(),toastr.success(e);break;case"warning":toastr.clear(),toastr.warning(e,"Warning",{closeButton:!0,tapToDismiss:!0});break;case"error":toastr.clear(),toastr.error(e,"Error",{closeButton:!0,tapToDismiss:!0,timeOut:!1});break;default:toastr.clear()}},i.$on("showToast",function(t,e){var o=e.toastType,s=e.text;r.showToast(o,s)}),r.currentTime="",r.currentTime=moment().format("ddd, MMM D, H:mm");var y=function(){r.currentTime=moment().format("ddd, MMM D, H:mm")};s(y,2e4,0,!0),r.newPost=!1,r.showNewPost=function(){r.newPost=!0},r.hideNewPost=function(){r.newPost=!1},l.getUserData().success(function(t){r.userData=d.userData(t.userData),"yes"==r.userData.isRegistered&&(r.clientIsRegistered=!0),u.emit("joinRoom",{room:t.userData.uniqueCuid}),r.responseStatusHandler(t)}).error(function(t){r.responseStatusHandler(t)}),u.on("joined",function(){console.log("JOIN SUCCESS")}),r.newPostModel={postHeading:"",postContent:"",postSummary:""},r.postSummaryIsEmpty=!0,r.postSummaryHasExceededMaximum=!1,r.checkIfPostSummaryIsEmpty=function(){return r.postSummaryIsEmpty=0==r.newPostModel.postSummary.length?!0:!1,r.postSummaryIsEmpty},r.checkPostSummaryMaxLength=function(t){return r.postSummaryHasExceededMaximum=r.newPostModel.postSummary.length>t?!0:!1,r.postSummaryHasExceededMaximum},r.submitNewPost=function(){if(0==r.newPostModel.postContent.length)r.showToast("warning","Please add some content to the post first");else if(r.newPostModel.postSummary.length>1600)r.showToast("warning","The post summary cannot exceed 1600 characters");else{var t={postHeading:r.newPostModel.postHeading,postContent:r.newPostModel.postContent,postSummary:r.newPostModel.postSummary};p.submitNewPost(t).success(function(t){r.hideNewPost(),r.responseStatusHandler(t),r.newPostModel.postHeading="",r.newPostModel.postContent="",r.newPostModel.postSummary=""}).error(function(t){r.responseStatusHandler(t)})}},r.logoutClient=function(){m.logoutClient().success(function(t){r.responseStatusHandler(t)}).error(function(t){r.responseStatusHandler(t)})},i.$on("reconnect",function(){}),o.info("MainController booted successfully")}]),angular.module("adminHomeApp").controller("PostsController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","$stateParams",function(t,e,o,s,n,a,r,i,u,c,l,d,g,m,p){function f(){r.posts.forEach(function(t){t.postSummary=r.makeVideoIframesResponsive(t.postSummary)})}function h(){r.suggestedPosts=[],m.getSuggestedPostsFromServer().success(function(t){function e(){r.suggestedPosts.forEach(function(t){t.postSummary=r.makeVideoIframesResponsive(t.postSummary)})}t.postsArray.length>0?(r.showSuggestedPostsOnly(),r.suggestedPosts=t.postsArray,w(),e()):(r.suggestedPosts=[],r.showSuggestedPosts=!1,r.goToUniversalBanner())}).error(function(t){r.goToUniversalBanner(),r.suggestedPosts=[],r.showSuggestedPosts=!1,r.responseStatusHandler(t)})}function P(){m.getPostsFromServer(p.pageNumber).success(function(t){if(0==t.postsArray.length){r.posts=[];var e={banner:!0,bannerClass:"alert alert-dismissible alert-success",msg:"No more posts to show"};r.responseStatusHandler(e),r.showPosts=!1,h(),r.goToUniversalBanner()}else r.posts=m.updatePosts(t.postsArray),r.showThePostsOnly(),w(),t.postCount&&(r.postsCount=t.postsCount),f()}).error(function(t){r.responseStatusHandler(t),r.posts=[],r.showPosts=!1,h()})}function w(){r.posts.forEach(function(t){t.theTimeAgo=e("timeago")(t.createdAt),t.postDate=moment(t.createdAt).format("ddd, MMM D, H:mm")})}r.posts=m.getCurrentPosts(),r.postsCount=m.getCurrentPostsCount(),r.suggestedPosts=[],r.showPosts=!1,r.showSuggestedPosts=!1,r.showThePostsOnly=function(){r.showPosts=!0,r.showSuggestedPosts=!1},r.showSuggestedPostsOnly=function(){r.showPosts=!1,r.showSuggestedPosts=!0},P(),r.checkIfPostsIsEmpty=function(){return 0==r.posts.length},s(w,12e4,0,!0),w(),i.$on("newPost",function(t,e){1==p.pageNumber&&(r.posts.unshift(e.post),w(),f()),e.postCount&&(r.postCount=e.postCount)}),i.$on("reconnect",function(){P()}),o.info("PostController booted successfully")}]).controller("FullPostController",["$q","$filter","$log","$interval","$window","$location","$scope","$rootScope","socket","mainService","socketService","globals","$modal","PostService","$stateParams",function(t,e,o,s,n,a,r,i,u,c,l,d,g,m,p){function f(){r.showHideLoadingBanner(!0),r.suggestedPosts=[],m.getSuggestedPostsFromServer().success(function(t){function e(){r.suggestedPosts.forEach(function(t){t.postSummary=r.makeVideoIframesResponsive(t.postSummary)})}t.postsArray.length>0?(r.showSuggestedPostsOnly(),r.suggestedPosts=t.postsArray,P(),e()):(r.suggestedPosts=[],r.showSuggestedPosts=!1,r.goToUniversalBanner())}).error(function(t){r.goToUniversalBanner(),r.suggestedPosts=[],r.showSuggestedPosts=!1,r.responseStatusHandler(t)})}function h(){r.showHideLoadingBanner(!0),m.getPostFromServer(r.postIndex).success(function(t){function e(){r.post.postContent=r.makeVideoIframesResponsive(r.post.postContent)}r.post=t.thePost,r.responseStatusHandler(t),0!=r.calcObjectLength(r.post)?(r.showThePostOnly(),P(),w(),r.postIsLoaded=!0,e()):(r.post={},r.showPost=!1,f(),r.goToUniversalBanner())}).error(function(t){r.responseStatusHandler(t),r.post={},r.showPost=!1,f()})}function P(){r.post&&(r.post.theTimeAgo=e("timeago")(r.post.createdAt),r.post.postDate=moment(r.post.createdAt).format("ddd, MMM D, H:mm")),r.suggestedPosts&&r.suggestedPosts.forEach(function(t){t.theTimeAgo=e("timeago")(t.createdAt),t.postDate=moment(t.createdAt).format("ddd, MMM D, H:mm")})}function w(){r.post.postUrl="http://"+a.host()+"/#!/post/"+r.post.postIndex}r.postIndex=p.postIndex,r.post={},r.suggestedPosts=[],r.showPost=!1,r.showSuggestedPosts=!1,r.showThePostOnly=function(){r.showHideLoadingBanner(!1),r.showPost=!0,r.showSuggestedPosts=!1},r.showSuggestedPostsOnly=function(){r.showPost=!1,r.showSuggestedPosts=!0,r.showHideLoadingBanner(!1)},r.postIsLoaded=!1,h(),s(P,12e4,0,!0),r.editingMode=!1,r.postBackup=r.post,r.goIntoPostEditingMode=function(){r.postBackup=r.post,r.editingMode=!0},r.goIntoFullPostViewMode=function(){r.editingMode=!1},r.editPostSummaryIsEmpty=!0,r.editPostSummaryHasExceededMaximum=!1,r.checkIfEditPostSummaryIsEmpty=function(){return r.post.postSummary?(r.editPostSummaryIsEmpty=0==r.post.postSummary.length?!0:!1,r.editPostSummaryIsEmpty):!0},r.checkEditPostSummaryMaxLength=function(t){return r.post.postSummary?(r.editPostSummaryHasExceededMaximum=r.post.postSummary.length>t?!0:!1,r.editPostSummaryHasExceededMaximum):!0},r.submitPostUpdate=function(){0==r.post.postContent.length?r.showToast("warning","Please add some content to the post first"):r.post.postSummary.length>1600?r.showToast("warning","The post summary cannot exceed 1600 characters"):m.submitPostUpdate(r.post).success(function(t){r.goIntoFullPostViewMode(),r.responseStatusHandler(t)}).error(function(t){r.responseStatusHandler(t)})},r.cancelPostUpdate=function(){r.post=r.postBackup,r.goIntoFullPostViewMode(),r.showToast("success","Update cancelled")},i.$on("postUpdate",function(t,e){r.post=e.post,P()}),i.$on("reconnect",function(){r.editingMode||h()}),o.info("FullPostController booted successfully")}]),angular.module("adminHomeApp").factory("globals",["$q","$window","$rootScope","socketService",function(t,e,o,s){var n={};return{userData:function(t){return t?n=t:n}}}]),angular.module("adminHomeApp").factory("HotService",["$log","$http","$window","$rootScope","socket","socketService","globals",function(t,e,o,s,n,a,r){var i=[];return n.on("hotThisWeekPosts",function(t){s.$broadcast("hotThisWeekPosts",t)}),{getHotThisWeek:function(){return i},getHotThisWeekFromServer:function(){return e.post("/api/getHotThisWeek",{})},updateHotThisWeek:function(t){return i=t,t}}}]),angular.module("adminHomeApp").factory("mainService",["$log","$window","$rootScope","socket","socketService","globals",function(t,e,o,s,n,a){return s.on("reconnect",function(){t.info("'reconnect sequence' triggered"),o.$broadcast("reconnect")}),{done:function(){return 1}}}]),angular.module("adminHomeApp").factory("PostService",["$log","$http","$window","$rootScope","socket","socketService","globals",function(t,e,o,s,n,a,r,i){var u=[],c=0;return n.on("newPost",function(t){s.$broadcast("newPost",t)}),n.on("postUpdate",function(t){s.$broadcast("postUpdate",t)}),{getCurrentPosts:function(){return u},getCurrentPostsCount:function(){return c},getPostsFromServer:function(t){return e.post("/api/getPosts",{page:t})},getSuggestedPostsFromServer:function(){return e.post("/api/getSuggestedPosts",{})},updatePosts:function(t){return u=t,t},getPostFromServer:function(t){return e.post("/api/getPost",{postIndex:t})},submitNewPost:function(t){return e.post("/api/newPost",{newPost:t})},submitPostUpdate:function(t){return e.post("/api/updatePost",{postUpdate:t})}}}]),angular.module("adminHomeApp").factory("socket",["$log","$location","$rootScope",function(t,e,o){var s;s=e.port()?e.host()+":"+e.port():e.host();var n=io.connect(s);return{on:function(t,e){n.on(t,function(){var t=arguments;o.$apply(function(){e.apply(n,t)})})},emit:function(t,e,s){n.emit(t,e,function(){var t=arguments;o.$apply(function(){s&&s.apply(n,t)})})},removeAllListeners:function(t,e){n.removeAllListeners(t,function(){var t=arguments;o.$apply(function(){e.apply(n,t)})})}}}]).factory("socketService",["$log","$http","$rootScope",function(t,e,o){return{getUserData:function(){return e.get("/api/getUserData")},sendContactUs:function(t){return e.post("/contactUs",t)}}}]).factory("logoutService",["$http",function(t){return{logoutClient:function(){return t.post("/api/logoutClient")}}}]);
//# sourceMappingURL=concatenated.min.js.map